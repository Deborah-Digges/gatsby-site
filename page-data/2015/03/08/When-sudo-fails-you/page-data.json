{"componentChunkName":"component---src-templates-blog-template-js","path":"/2015/03/08/When-sudo-fails-you/","result":{"data":{"markdownRemark":{"html":"<div class=\"disclaimer-header\" >\n\tThis post is only relevant to the OS X family and other flavours of UNIX that support BSD flags.\n</div>\n<p>I was running the fairly common command to make a read-only file writable and ran into permission issues:</p>\n<pre><code class=\"language-bash\">$ chmod +w text.properties \nchmod: Unable to change file mode on text.properties: Operation not permitted\n</code></pre>\n<p>Strange, especially since I <em>own</em> the file:</p>\n<pre><code class=\"language-bash\">$ ls -l text.properties\n-r--r--r--  1 ddigges  846622648  0 Mar  3 09:46 text.properties\n</code></pre>\n<p>To appease the permission gods I tried what I most often think is the fix-me for permission problems:</p>\n<pre><code class=\"language-bash\">$ sudo chmod +w text.properties\nchmod: Unable to change file mode on text.properties: Operation not permitted\n</code></pre>\n<p><em>I’m running the command as superuser! Dare defy me.</em></p>\n<p>What is this mysterious power that will not cower even before the superuser? After digging around a bit in the OS X forums I came across this:</p>\n<blockquote>\n<p>“Immutable flags are file system attributes that, when enabled, prohibit changes to objects i.e. lock them. Enabled, immutable flags supersede permissions: you cannot modify an object whose immutable flags have been enabled despite having Read &#x26; Write permissions on that object.”\n-<a href=\"http://thexlab.com/faqs/immutableflags.html\">The X Lab</a></p>\n</blockquote>\n<p>These flags are BSD file flags that are used primarily to limit a file's use. They often override traditional Unix permissions.\nThe <em>-O option of ls</em> can be used to inspect what file flags are currently enabled:</p>\n<pre><code class=\"language-bash\">$ ls -lO text.properties\n-r--r--r--  1 ddigges  846622648  uchg 0 Mar  3 09:46 text.properties\n</code></pre>\n<p>uchg is the <em>User immutable flag</em> that prevents  inadvertent modification to a file at the user level. When uchg is set, it marks the file as immutable preventing it from being  changed, moved, or deleted, even by root. </p>\n<p>Similarly, there is a flag schg which is the <em>System Immutable Flag</em> which can only be enabled or disabled by the superuser in single user mode.</p>\n<p>The uchg file flag can be set or cleared by the owner of the file. To clear the uchg flag on the file, run the <a href=\"http://www.openbsd.org/cgi-bin/man.cgi?query=chflags&#x26;section=1\"><em>chflags</em></a> command with <em>nouchg</em>:</p>\n<pre><code class=\"language-bash\">$ chflags nouchg text.properties \n</code></pre>\n<p>The uchg flag will have been cleared:</p>\n<pre><code class=\"language-bash\">$ ls -lO text.properties \n-r--r--r--  1 ddigges  846622648  - 0 Mar  3 09:46 text.properties\n</code></pre>\n<pre><code class=\"language-bash\">$ chmod +w text.properties \n$ ls -l text.properties \n-rw-r--r--  1 ddigges  846622648  0 Mar  3 09:46 text.properties\n</code></pre>\n<p>And thus will be restored the balance of power in the universe.</p>","frontmatter":{"title":"When sudo Fails You"},"fields":{"date":"2015-03-08","slug":"2015/03/08/When-sudo-fails-you/"}}},"pageContext":{"slug":"2015/03/08/When-sudo-fails-you/","date":"2015-03-08"}},"staticQueryHashes":[]}